package com.silverpine.uu.core

import java.nio.ByteBuffer
import java.security.SecureRandom
import java.util.UUID

/**
 * UURandom
 * Useful Utilities - UURandom contains helper methods for generating random data
 *
 * License:
 * You are free to use this code for whatever purposes you desire.
 * The only requirement is that you smile everytime you use it. :-)
 */
object UURandom
{
    private val secureRandom = SecureRandom.getInstanceStrong()

    private val UPPER_CASE = Pair('A','Z')
    private val LOWER_CASE = Pair('a','z')
    private val NUMBERS = Pair('0','9')

    /**
     * Generates a random byte array using java.security.SecureRandom
     *
     * @param length length of byte array to generate
     * @return byte array filled with data.
     * @see java.security.SecureRandom
     */
    fun bytes(length: Int): ByteArray
    {
        if (length < 0)
        {
            return ByteArray(0)
        }

        val output = ByteArray(length)
        secureRandom.nextBytes(output)
        return output
    }

    /**
     * Generates a random integer with an upper and lower bound
     *
     * @param min minimum value
     * @param max maximum value
     * @return a random integer
     */
    fun int(min: Int, max: Int): Int
    {
        val range = max - min
        return secureRandom.nextInt(range) + min
    }

    /**
     * Generates a random integer with an upper bound
     *
     * @param max maximum value
     * @return a random integer
     */
    fun int(max: Int): Int
    {
        return int(0, max)
    }

    /**
     * Generates a random integer
     *
     * @return a random integer
     */
    fun int(): Int
    {
        return secureRandom.nextInt()
    }

    /**
     * Generates a random unsigned integer
     *
     * @return a random unsigned integer
     */
    fun uInt(): UInt
    {
        return int().toUInt()
    }

    /**
     * Generates a random long
     *
     * @return a random long
     */
    fun long(): Long
    {
        return secureRandom.nextLong()
    }

    /**
     * Generates a random unsigned long
     *
     * @return a random unsigned long
     */
    fun uLong(): ULong
    {
        return long().toULong()
    }

    /**
     * Generates a random double
     *
     * @return a random double
     */
    fun double(): Double
    {
        return secureRandom.nextDouble()
    }

    /**
     * Generates a random float
     *
     * @return a random float
     */
    fun float(): Float
    {
        return secureRandom.nextFloat()
    }

    /**
     * Generates a random boolean
     *
     * @return a random boolean
     */
    fun bool(): Boolean
    {
        return secureRandom.nextBoolean()
    }

    /**
     * Generates a random byte
     *
     * @return a random byte
     */
    fun byte(): Byte
    {
        val result = bytes(1)
        return result[0]
    }

    /**
     * Generates a random unsigned byte
     *
     * @return a random unsigned byte
     */
    fun uByte(): UByte
    {
        val result = bytes(1)
        return result[0].toUByte()
    }

    /**
     * Generates a random short
     *
     * @return a random short
     */
    fun short(): Short
    {
        val result = bytes(2)
        val bb = ByteBuffer.wrap(result)
        return bb.short
    }

    /**
     * Generates a random unsigned short
     *
     * @return a random unsigned short
     */
    fun uShort(): UShort
    {
        return short().toUShort()
    }

    /**
     * Generates a random byte
     *
     * @return a random byte
     */
    fun char(): Char
    {
        return Char(uShort())
    }

    /**
     * Generates a random UUID and returns the string form
     *
     * @return a random string
     */
    fun uuid(): String
    {
        val uid = UUID.randomUUID()
        return uid.toString()
    }


    /**
     * Generates a random array of objects using a provided random generator function
     *
     * @param T the type of objects to generate
     * @param maxLength maximum length of the array to generate
     * @param random function that generates a random object of type T
     * @return array of randomly generated objects
     */
    inline fun <reified T> objArray(maxLength: Int, random: ()->T): Array<T>
    {
        val length = int(maxLength)

        val working = arrayListOf<T>()

        for (i in 0 until length)
        {
            working.add(random())
        }

        return working.toTypedArray()
    }

    /**
     * Generates a random array of Byte objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated Byte objects
     */
    fun byteObjArray(maxLength: Int): Array<Byte>
    {
        return objArray(maxLength, this::byte)
    }

    /**
     * Generates a random array of UByte objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated UByte objects
     */
    fun uByteObjArray(maxLength: Int): Array<UByte>
    {
        return objArray(maxLength, this::uByte)
    }

    /**
     * Generates a random array of Short objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated Short objects
     */
    fun shortObjArray(maxLength: Int): Array<Short>
    {
        return objArray(maxLength, this::short)
    }

    /**
     * Generates a random array of UShort objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated UShort objects
     */
    fun uShortObjArray(maxLength: Int): Array<UShort>
    {
        return objArray(maxLength, this::uShort)
    }

    /**
     * Generates a random array of Int objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated Int objects
     */
    fun intObjArray(maxLength: Int): Array<Int>
    {
        return objArray(maxLength, this::int)
    }

    /**
     * Generates a random array of UInt objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated UInt objects
     */
    fun uIntObjArray(maxLength: Int): Array<UInt>
    {
        return objArray(maxLength, this::uInt)
    }

    /**
     * Generates a random array of Long objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated Long objects
     */
    fun longObjArray(maxLength: Int): Array<Long>
    {
        return objArray(maxLength, this::long)
    }

    /**
     * Generates a random array of ULong objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated ULong objects
     */
    fun uLongObjArray(maxLength: Int): Array<ULong>
    {
        return objArray(maxLength, this::uLong)
    }

    /**
     * Generates a random array of Float objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated Float objects
     */
    fun floatObjArray(maxLength: Int): Array<Float>
    {
        return objArray(maxLength, this::float)
    }

    /**
     * Generates a random array of Double objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated Double objects
     */
    fun doubleObjArray(maxLength: Int): Array<Double>
    {
        return objArray(maxLength, this::double)
    }

    /**
     * Generates a random array of Boolean objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated Boolean objects
     */
    fun boolObjArray(maxLength: Int): Array<Boolean>
    {
        return objArray(maxLength, this::bool)
    }

    /**
     * Generates a random array of Char objects
     *
     * @param maxLength maximum length of the array to generate
     * @return array of randomly generated Char objects
     */
    fun charObjArray(maxLength: Int): Array<Char>
    {
        return objArray(maxLength, this::char)
    }

    /**
     * Generates a random ShortArray
     *
     * @param maxLength maximum length of the array to generate
     * @return ShortArray filled with random values
     */
    fun shortArray(maxLength: Int): ShortArray
    {
        val length = int(maxLength)

        val a = ShortArray(length)

        for (i in 0 until length)
        {
            a[i] = short()
        }

        return a
    }

    /**
     * Generates a random IntArray
     *
     * @param maxLength maximum length of the array to generate
     * @return IntArray filled with random values
     */
    fun intArray(maxLength: Int): IntArray
    {
        val length = int(maxLength)

        val a = IntArray(length)

        for (i in 0 until length)
        {
            a[i] = int()
        }
        return a
    }

    /**
     * Generates a random LongArray
     *
     * @param maxLength maximum length of the array to generate
     * @return LongArray filled with random values
     */
    fun longArray(maxLength: Int): LongArray
    {
        val length = int(maxLength)

        val a = LongArray(length)

        for (i in 0 until length)
        {
            a[i] = long()
        }

        return a
    }

    /**
     * Generates a random FloatArray
     *
     * @param maxLength maximum length of the array to generate
     * @return FloatArray filled with random values
     */
    fun floatArray(maxLength: Int): FloatArray
    {
        val length = int(maxLength)

        val a = FloatArray(length)

        for (i in 0 until length)
        {
            a[i] = float()
        }
        return a
    }

    /**
     * Generates a random DoubleArray
     *
     * @param maxLength maximum length of the array to generate
     * @return DoubleArray filled with random values
     */
    fun doubleArray(maxLength: Int): DoubleArray
    {
        val length = int(maxLength)

        val a = DoubleArray(length)

        for (i in 0 until length)
        {
            a[i] = double()
        }

        return a
    }

    /**
     * Generates a random BooleanArray
     *
     * @param maxLength maximum length of the array to generate
     * @return BooleanArray filled with random values
     */
    fun boolArray(maxLength: Int): BooleanArray
    {
        val length = int(maxLength)

        val a = BooleanArray(length)

        for (i in 0 until length)
        {
            a[i] = bool()
        }

        return a
    }

    /**
     * Generates a random CharArray
     *
     * @param maxLength maximum length of the array to generate
     * @return CharArray filled with random values
     */
    fun charArray(maxLength: Int): CharArray
    {
        val length = int(maxLength)

        val a = CharArray(length)

        for (i in 0 until length)
        {
            a[i] = char()
        }
        return a
    }

    /**
     * Generates a random string containing only ASCII letters (A-Z, a-z)
     *
     * @param maxLength maximum length of the string to generate
     * @return random string containing only ASCII letters
     */
    fun asciiLetters(maxLength: Int): String
    {
        return chars(maxLength, arrayListOf(UPPER_CASE, LOWER_CASE))
    }

    /**
     * Generates a random string containing only digits (0-9)
     *
     * @param maxLength maximum length of the string to generate
     * @return random string containing only digits
     */
    fun digits(maxLength: Int): String
    {
        return chars(maxLength, arrayListOf(NUMBERS))
    }

    /**
     * Generates a random string containing ASCII letters and numbers (A-Z, a-z, 0-9)
     *
     * @param maxLength maximum length of the string to generate
     * @return random string containing ASCII letters and numbers
     */
    fun asciiLettersOrNumbers(maxLength: Int): String
    {
        return chars(maxLength, arrayListOf(UPPER_CASE, LOWER_CASE, NUMBERS))
    }

    /**
     * Generates a random string containing characters from specified ranges
     *
     * @param maxLength maximum length of the string to generate
     * @param ranges list of character ranges to choose from (defaults to all characters)
     * @return random string containing characters from the specified ranges
     */
    fun chars(
        maxLength: Int,
        ranges: ArrayList<Pair<Char, Char>> = arrayListOf(Pair(Char.MIN_VALUE, Char.MAX_VALUE))): String
    {
        val length = int(maxLength)

        val sb = StringBuilder()

        while (sb.length < length)
        {
            val c = char()

            for (i in 0 until ranges.size)
            {
                if (c in ranges[i].first .. ranges[i].second)
                {
                    sb.append(c)
                    break
                }
            }
        }

        return sb.toString()
    }

    /**
     * Generates a random ASCII word (letters only)
     *
     * @param maxLength maximum length of the word to generate
     * @return random ASCII word containing only letters
     */
    fun asciiWord(maxLength: Int): String
    {
        return asciiLetters(maxLength)
    }

    /**
     * Generates a random string containing multiple ASCII words separated by spaces
     *
     * @param maxNumberOfWords maximum number of words to generate
     * @param maxWordLength maximum length of each word
     * @return random string containing ASCII words separated by spaces
     */
    fun asciiWords(maxNumberOfWords: Int, maxWordLength: Int): String
    {
        val sb = StringBuilder()
        val words = int(maxNumberOfWords)

        for (i in 0 until words)
        {
            sb.append(asciiWord(maxWordLength))
            sb.append(" ")
        }

        return sb.toString()
    }
}